
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>DnD Session Transcribe Web UI</title>
  <style>
    :root {
      color-scheme: dark;
      --bg: #020305;
      --panel: rgba(8, 18, 26, 0.82);
      --border: rgba(57, 255, 20, 0.35);
      --text: #d7ffda;
      --muted: rgba(141, 214, 145, 0.8);
      --accent: #39ff14;
      --accent-soft: rgba(57, 255, 20, 0.15);
      --danger: #ff3c7f;
      font-family: 'Fira Code', 'JetBrains Mono', Menlo, Consolas, monospace;
    }

    body {
      margin: 0;
      padding: clamp(1.5rem, 3vw + 1rem, 3.5rem);
      background: radial-gradient(circle at top left, rgba(57,255,20,0.08), transparent 45%),
                  radial-gradient(circle at bottom right, rgba(0,180,255,0.08), transparent 40%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
      box-sizing: border-box;
    }

    h1 {
      font-size: 2.75rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-bottom: 2rem;
      text-shadow: 0 0 18px rgba(57,255,20,0.7), 0 0 32px rgba(0, 255, 255, 0.35);
      text-align: center;
    }

    h2 {
      margin-top: 3rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 1.1rem;
      color: var(--muted);
      text-align: center;
    }

    form {
      background: var(--panel);
      border: 1px solid var(--border);
      box-shadow: 0 0 25px rgba(57,255,20,0.08);
      border-radius: 18px;
      padding: 2rem;
      backdrop-filter: blur(12px);
      width: min(100%, 1100px);
      margin: 0 auto;
    }

    fieldset {
      border: none;
      padding: 0;
      margin: 0;
    }

    label {
      display: block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
      margin-bottom: 0.35rem;
    }

    input[type='text'],
    input[type='number'],
    input[type='file'],
    select,
    textarea {
      width: 100%;
      background: rgba(2, 4, 6, 0.65);
      border: 1px solid rgba(57,255,20,0.35);
      border-radius: 10px;
      padding: 0.65rem 0.75rem;
      color: var(--text);
      font-family: inherit;
      box-shadow: inset 0 0 8px rgba(57,255,20,0.12);
    }

    input[type='file'] {
      padding: 0.45rem 0.75rem;
      cursor: pointer;
      border-style: dashed;
    }

    textarea {
      min-height: 5rem;
      resize: vertical;
    }

    .help-text {
      margin: 0 0 1.75rem;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .job-configs {
      margin-top: 1.5rem;
    }

    .job-config {
      margin-top: 1.5rem;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1.5rem;
      background: rgba(3, 10, 14, 0.85);
      box-shadow: inset 0 0 0 1px rgba(57,255,20,0.08), 0 0 22px rgba(0,0,0,0.35);
    }

    .job-config-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
    }

    .job-config-header h3 {
      margin: 0;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      font-size: 0.95rem;
      color: var(--accent);
    }

    .config-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.25rem;
    }

    .config-card {
      border: 1px solid rgba(57,255,20,0.25);
      border-radius: 12px;
      padding: 1rem;
      background: rgba(1, 8, 10, 0.6);
      position: relative;
      overflow: hidden;
    }

    .config-card::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      box-shadow: 0 0 18px rgba(57,255,20,0.1);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .config-card:hover::after {
      opacity: 1;
    }

    .config-card h4 {
      margin: 0 0 0.75rem;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.24em;
      color: var(--accent);
    }

    .config-card.wide {
      grid-column: 1 / -1;
    }

    .checkbox-grid {
      display: grid;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .job-controls {
      margin-top: 1.25rem;
      text-align: right;
    }

    .form-actions {
      margin-top: 2rem;
      text-align: right;
    }

    .checkbox-grid label,
    .checkbox-inline {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    input[type='checkbox'] {
      width: auto;
      accent-color: var(--accent);
      transform: scale(1.15);
    }

    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-top: 0.75rem;
    }

    .preview-field {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .preview-field.full {
      grid-column: 1 / -1;
    }

    .neon-button {
      border: 1px solid var(--accent);
      background: linear-gradient(135deg, rgba(57,255,20,0.25), rgba(57,255,20,0.05));
      color: var(--text);
      padding: 0.65rem 1.75rem;
      border-radius: 999px;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.28em;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease;
      box-shadow: 0 0 12px rgba(57,255,20,0.35);
    }

    .neon-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 22px rgba(57,255,20,0.55);
    }

    .neon-button.secondary {
      border-color: rgba(0,255,255,0.55);
      color: rgba(152, 244, 255, 0.95);
      box-shadow: 0 0 12px rgba(0,255,255,0.32);
      background: linear-gradient(135deg, rgba(0,255,255,0.25), rgba(0,255,255,0.05));
    }

    .neon-button.secondary:hover {
      box-shadow: 0 0 22px rgba(0,255,255,0.52);
    }

    table {
      width: min(100%, 1100px);
      margin: 1rem auto 0;
      border-collapse: collapse;
      border: 1px solid var(--border);
      background: rgba(3, 12, 14, 0.78);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 0 18px rgba(0,0,0,0.45);
    }

    th, td {
      padding: 0.85rem 1rem;
      border-bottom: 1px solid rgba(57,255,20,0.15);
      font-size: 0.85rem;
    }

    th {
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: rgba(152, 244, 255, 0.85);
      background: rgba(0,255,255,0.05);
    }

    tr:last-child td {
      border-bottom: none;
    }

    a {
      color: var(--accent);
    }

    .inline-form {
      display: inline;
    }

    .delete-button {
      background: linear-gradient(135deg, rgba(255, 60, 127, 0.5), rgba(255, 0, 128, 0.15));
      border-color: rgba(255, 60, 127, 0.6);
      box-shadow: 0 0 16px rgba(255, 60, 127, 0.32);
    }

    .message {
      margin: 0 auto 1.5rem;
      width: min(100%, 1100px);
      padding: 0.85rem 1.2rem;
      border-radius: 999px;
      border: 1px solid rgba(0,255,255,0.45);
      background: rgba(0,255,255,0.12);
      color: rgba(191, 250, 255, 0.95);
      letter-spacing: 0.14em;
      text-transform: uppercase;
      font-size: 0.8rem;
    }

    @media (max-width: 960px) {
      form {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <h1>DnD Session Transcribe</h1>
  
  <form action="/transcribe" method="post" enctype="multipart/form-data">
    <fieldset>
      <label for="audio_file">Audio signal</label>
      <input id="audio_file" name="audio_file" type="file" required />
      <div class="job-configs">
        <p class="help-text">Queue parallel loadouts to A/B models, prompts, and compute knobs. Every configuration reuses the uploaded audio for rapid experiments.</p>
        <div id="jobs-container">
          <div class="job-config" data-job-index="0"><div class="job-config-header"><h3><span class="job-number"></span> Loadout</h3></div><div class="config-grid"><section class="config-card"><h4>Control Center</h4><label for="job-0-log_level">Log level</label><select id="job-0-log_level" name="job-0-log_level"><option value='CRITICAL'>Critical</option><option value='ERROR'>Error</option><option value='WARNING' selected>Warning</option><option value='INFO'>Info</option><option value='DEBUG'>Debug</option><option value="random">Random</option><option value="all">All</option></select><label for="job-0-num_speakers">Number of speakers</label><input id="job-0-num_speakers" name="job-0-num_speakers" type="number" min="1" placeholder="auto" /><div class="checkbox-grid"><label><input type="checkbox" name="job-0-ram" value="true" checked /> Stage audio in RAM</label><label><input type="checkbox" name="job-0-resume" value="true" checked /> Resume from checkpoints</label><label><input type="checkbox" name="job-0-precise_rerun" value="true" checked /> Precise re-run</label></div></section><section class="config-card"><h4>ASR Engine</h4><label for="job-0-asr_model">Faster-Whisper model</label><input id="job-0-asr_model" name="job-0-asr_model" type="text" list="asr-models" placeholder="config default" /><label for="job-0-asr_device">Device override</label><select id="job-0-asr_device" name="job-0-asr_device"><option value='' selected>Config default</option><option value='cpu'>cpu</option><option value='cuda'>cuda</option><option value='mps'>mps</option><option value="random">Random</option><option value="all">All</option></select><label for="job-0-asr_compute_type">Compute type</label><input id="job-0-asr_compute_type" name="job-0-asr_compute_type" type="text" list="compute-types" placeholder="auto" /></section><section class="config-card"><h4>Prompt Engineering</h4><label for="job-0-hotwords">Hotwords</label><textarea id="job-0-hotwords" name="job-0-hotwords" rows="3" placeholder="One keyword per line"></textarea><label for="job-0-initial_prompt">Initial prompt</label><textarea id="job-0-initial_prompt" name="job-0-initial_prompt" rows="3" placeholder="Drop in scene context"></textarea><label for="job-0-spelling_map">Spelling corrections (CSV)</label><textarea id="job-0-spelling_map" name="job-0-spelling_map" rows="3" placeholder="wrong,right
Strahd,Strahd von Zarovich"></textarea></section><section class="config-card"><h4>Enhancements</h4><label for="job-0-vocal_extract">Preprocessing</label><select id="job-0-vocal_extract" name="job-0-vocal_extract"><option value='' selected>Config default</option><option value='off'>Off</option><option value='bandpass'>Band-pass filter</option><option value="random">Random</option><option value="all">All</option></select><label for="job-0-precise_model">Precise model</label><input id="job-0-precise_model" name="job-0-precise_model" type="text" list="asr-models" placeholder="auto" /><label for="job-0-precise_device">Precise device</label><select id="job-0-precise_device" name="job-0-precise_device"><option value='' selected>Config default</option><option value='cpu'>cpu</option><option value='cuda'>cuda</option><option value='mps'>mps</option><option value="random">Random</option><option value="all">All</option></select><label for="job-0-precise_compute_type">Precise compute</label><input id="job-0-precise_compute_type" name="job-0-precise_compute_type" type="text" list="compute-types" placeholder="auto" /></section><section class="config-card wide"><h4>Preview Builder</h4><label class="checkbox-inline"><input type="checkbox" id="job-0-preview_enabled" name="job-0-preview_enabled" value="true" checked /> Generate 10s teaser</label><div class="preview-grid"><div class="preview-field"><label for="job-0-preview_start">Start</label><input id="job-0-preview_start" name="job-0-preview_start" type="text" placeholder="0 or MM:SS" /></div><div class="preview-field"><label for="job-0-preview_duration">Duration</label><input id="job-0-preview_duration" name="job-0-preview_duration" type="text" placeholder="10" /></div><div class="preview-field full"><label for="job-0-preview_output">Custom WAV name</label><input id="job-0-preview_output" name="job-0-preview_output" type="text" placeholder="leave blank for default" /></div></div></section></div></div>
        </div>
        <div class="job-controls">
          <button type="button" id="add-job" class="neon-button secondary">Clone config</button>
        </div>
      </div>
    </fieldset>
    <div class="form-actions">
      <button type="submit" class="neon-button">Execute Stack</button>
    </div>
  </form>

  <h2>Run console</h2>
  <table>
    <thead><tr><th>Job</th><th>Status</th><th>Created</th><th>Updated</th><th>Error</th><th>Actions</th></tr></thead>
    <tbody>
      <tr><td colspan='6'>No jobs yet.</td></tr>
    </tbody>
  </table>
  <template id="job-template">
    <div class="job-config" data-job-index="__INDEX__"><div class="job-config-header"><h3><span class="job-number"></span> Loadout</h3><button type="button" class="remove-job neon-button secondary">Remove</button></div><div class="config-grid"><section class="config-card"><h4>Control Center</h4><label for="job-__INDEX__-log_level">Log level</label><select id="job-__INDEX__-log_level" name="job-__INDEX__-log_level"><option value='CRITICAL'>Critical</option><option value='ERROR'>Error</option><option value='WARNING' selected>Warning</option><option value='INFO'>Info</option><option value='DEBUG'>Debug</option><option value="random">Random</option><option value="all">All</option></select><label for="job-__INDEX__-num_speakers">Number of speakers</label><input id="job-__INDEX__-num_speakers" name="job-__INDEX__-num_speakers" type="number" min="1" placeholder="auto" /><div class="checkbox-grid"><label><input type="checkbox" name="job-__INDEX__-ram" value="true" checked /> Stage audio in RAM</label><label><input type="checkbox" name="job-__INDEX__-resume" value="true" checked /> Resume from checkpoints</label><label><input type="checkbox" name="job-__INDEX__-precise_rerun" value="true" checked /> Precise re-run</label></div></section><section class="config-card"><h4>ASR Engine</h4><label for="job-__INDEX__-asr_model">Faster-Whisper model</label><input id="job-__INDEX__-asr_model" name="job-__INDEX__-asr_model" type="text" list="asr-models" placeholder="config default" /><label for="job-__INDEX__-asr_device">Device override</label><select id="job-__INDEX__-asr_device" name="job-__INDEX__-asr_device"><option value='' selected>Config default</option><option value='cpu'>cpu</option><option value='cuda'>cuda</option><option value='mps'>mps</option><option value="random">Random</option><option value="all">All</option></select><label for="job-__INDEX__-asr_compute_type">Compute type</label><input id="job-__INDEX__-asr_compute_type" name="job-__INDEX__-asr_compute_type" type="text" list="compute-types" placeholder="auto" /></section><section class="config-card"><h4>Prompt Engineering</h4><label for="job-__INDEX__-hotwords">Hotwords</label><textarea id="job-__INDEX__-hotwords" name="job-__INDEX__-hotwords" rows="3" placeholder="One keyword per line"></textarea><label for="job-__INDEX__-initial_prompt">Initial prompt</label><textarea id="job-__INDEX__-initial_prompt" name="job-__INDEX__-initial_prompt" rows="3" placeholder="Drop in scene context"></textarea><label for="job-__INDEX__-spelling_map">Spelling corrections (CSV)</label><textarea id="job-__INDEX__-spelling_map" name="job-__INDEX__-spelling_map" rows="3" placeholder="wrong,right
Strahd,Strahd von Zarovich"></textarea></section><section class="config-card"><h4>Enhancements</h4><label for="job-__INDEX__-vocal_extract">Preprocessing</label><select id="job-__INDEX__-vocal_extract" name="job-__INDEX__-vocal_extract"><option value='' selected>Config default</option><option value='off'>Off</option><option value='bandpass'>Band-pass filter</option><option value="random">Random</option><option value="all">All</option></select><label for="job-__INDEX__-precise_model">Precise model</label><input id="job-__INDEX__-precise_model" name="job-__INDEX__-precise_model" type="text" list="asr-models" placeholder="auto" /><label for="job-__INDEX__-precise_device">Precise device</label><select id="job-__INDEX__-precise_device" name="job-__INDEX__-precise_device"><option value='' selected>Config default</option><option value='cpu'>cpu</option><option value='cuda'>cuda</option><option value='mps'>mps</option><option value="random">Random</option><option value="all">All</option></select><label for="job-__INDEX__-precise_compute_type">Precise compute</label><input id="job-__INDEX__-precise_compute_type" name="job-__INDEX__-precise_compute_type" type="text" list="compute-types" placeholder="auto" /></section><section class="config-card wide"><h4>Preview Builder</h4><label class="checkbox-inline"><input type="checkbox" id="job-__INDEX__-preview_enabled" name="job-__INDEX__-preview_enabled" value="true" checked /> Generate 10s teaser</label><div class="preview-grid"><div class="preview-field"><label for="job-__INDEX__-preview_start">Start</label><input id="job-__INDEX__-preview_start" name="job-__INDEX__-preview_start" type="text" placeholder="0 or MM:SS" /></div><div class="preview-field"><label for="job-__INDEX__-preview_duration">Duration</label><input id="job-__INDEX__-preview_duration" name="job-__INDEX__-preview_duration" type="text" placeholder="10" /></div><div class="preview-field full"><label for="job-__INDEX__-preview_output">Custom WAV name</label><input id="job-__INDEX__-preview_output" name="job-__INDEX__-preview_output" type="text" placeholder="leave blank for default" /></div></div></section></div></div>
  </template>
  <datalist id="asr-models">
    <option value="tiny"></option><option value="tiny.en"></option><option value="base"></option><option value="base.en"></option><option value="small"></option><option value="small.en"></option><option value="medium"></option><option value="medium.en"></option><option value="large-v2"></option><option value="large-v3"></option><option value="turbo"></option><option value="distil-large-v2"></option><option value="distil-large-v3"></option><option value="distil-medium.en"></option><option value="distil-small.en"></option>
  </datalist>
  <datalist id="compute-types">
    <option value="auto"></option><option value="float16"></option><option value="float32"></option><option value="int8"></option><option value="int8_float16"></option><option value="int8_float32"></option><option value="int8_float16_float32"></option>
  </datalist>
  <script>
    (function() {
      const container = document.getElementById('jobs-container');
      const template = document.getElementById('job-template');
      const addButton = document.getElementById('add-job');
      if (!container || !template || !addButton) {
        return;
      }

      let nextIndex = container.querySelectorAll('.job-config').length;

      function renumber() {
        const blocks = container.querySelectorAll('.job-config');
        blocks.forEach((block, idx) => {
          const numberEl = block.querySelector('.job-number');
          if (numberEl) {
            numberEl.textContent = String(idx + 1);
          }
        });
      }

      function createBlock(index) {
        const markup = template.innerHTML.replace(/__INDEX__/g, String(index));
        const wrapper = document.createElement('div');
        wrapper.innerHTML = markup.trim();
        return wrapper.firstElementChild;
      }

      function copyValues(source, target) {
        if (!source || !target) {
          return;
        }
        const fieldMap = new Map();
        target.querySelectorAll('input, select, textarea').forEach((element) => {
          const name = element.getAttribute('name');
          if (!name) {
            return;
          }
          const segments = name.includes('-') ? name.split('-').slice(2) : [name];
          fieldMap.set(segments.join('-'), element);
        });

        source.querySelectorAll('input, select, textarea').forEach((element) => {
          const name = element.getAttribute('name');
          if (!name) {
            return;
          }
          const segments = name.includes('-') ? name.split('-').slice(2) : [name];
          const key = segments.join('-');
          const destination = fieldMap.get(key);
          if (!destination) {
            return;
          }
          if (element instanceof HTMLInputElement && element.type === 'file') {
            return;
          }
          if (element instanceof HTMLInputElement && element.type === 'checkbox') {
            if (destination instanceof HTMLInputElement) {
              destination.checked = element.checked;
            }
            return;
          }
          if (destination instanceof HTMLInputElement && destination.type === 'checkbox') {
            destination.checked = false;
            return;
          }
          if ('value' in destination) {
            destination.value = element.value;
          }
        });
      }

      addButton.addEventListener('click', () => {
        const newBlock = createBlock(nextIndex);
        if (!newBlock) {
          return;
        }
        const blocks = container.querySelectorAll('.job-config');
        const source = blocks.length ? blocks[blocks.length - 1] : null;
        container.appendChild(newBlock);
        if (source) {
          copyValues(source, newBlock);
        }
        nextIndex += 1;
        renumber();
      });

      container.addEventListener('click', (event) => {
        const target = event.target;
        if (!(target instanceof Element)) {
          return;
        }
        if (!target.classList.contains('remove-job')) {
          return;
        }
        event.preventDefault();
        const block = target.closest('.job-config');
        if (!block) {
          return;
        }
        if (container.querySelectorAll('.job-config').length <= 1) {
          return;
        }
        block.remove();
        renumber();
      });

      renumber();
    })();
  </script>
</body>
</html>
